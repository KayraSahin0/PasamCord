<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PasamCord - P2P Video Chat</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="landing-card">
            <h1 class="logo">PasamCord</h1>
            <p class="subtitle">P2P Video & Sesli Sohbet</p>
            
            <div class="form-group">
                <label for="username">Kullanıcı Adı</label>
                <input type="text" id="username" placeholder="Kullanıcı adınızı girin" maxlength="20" required>
            </div>

            <div class="form-group">
                <label for="roomCode">Oda Kodu (isteğe bağlı)</label>
                <input type="text" id="roomCode" placeholder="Oda kodunu girin" maxlength="5" pattern="[A-Z0-9]{5}">
            </div>

            <div class="button-group">
                <button id="createRoomBtn" class="btn btn-primary">Oda Oluştur</button>
                <button id="joinRoomBtn" class="btn btn-secondary">Odaya Katıl</button>
            </div>

            <div id="errorMessage" class="error-message"></div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const usernameInput = document.getElementById('username');
        const roomCodeInput = document.getElementById('roomCode');
        const createRoomBtn = document.getElementById('createRoomBtn');
        const joinRoomBtn = document.getElementById('joinRoomBtn');
        const errorMessage = document.getElementById('errorMessage');

        // Create room
        createRoomBtn.addEventListener('click', () => {
            const username = usernameInput.value.trim();
            if (!username) {
                showError('Lütfen bir kullanıcı adı girin');
                return;
            }

            createRoomBtn.disabled = true;
            createRoomBtn.textContent = 'Oluşturuluyor...';
            socket.emit('create-room', { username });
        });

        // Join room
        joinRoomBtn.addEventListener('click', () => {
            const username = usernameInput.value.trim();
            const roomCode = roomCodeInput.value.trim().toUpperCase();

            if (!username) {
                showError('Lütfen bir kullanıcı adı girin');
                return;
            }

            if (!roomCode || roomCode.length !== 5) {
                showError('Lütfen geçerli bir 5 karakterlik oda kodu girin');
                return;
            }

            joinRoomBtn.disabled = true;
            joinRoomBtn.textContent = 'Katılıyor...';
            socket.emit('join-room', { username, roomId: roomCode, isNewRoom: false });
        });

        // Socket events
        socket.on('room-created', ({ roomId }) => {
            const username = usernameInput.value.trim();
            // Automatically join the created room
            socket.emit('join-room', { username, roomId, isNewRoom: true });
        });

        socket.on('room-joined', (data) => {
            const username = usernameInput.value.trim();
            const roomId = data.roomId || roomCodeInput.value.trim().toUpperCase();
            window.location.href = `/room.html?username=${encodeURIComponent(username)}&roomId=${roomId}`;
        });

        socket.on('error', ({ message }) => {
            showError(message);
            createRoomBtn.disabled = false;
            createRoomBtn.textContent = 'Oda Oluştur';
            joinRoomBtn.disabled = false;
            joinRoomBtn.textContent = 'Odaya Katıl';
        });

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }

        // Allow Enter key to submit
        usernameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                if (roomCodeInput.value.trim()) {
                    joinRoomBtn.click();
                } else {
                    createRoomBtn.click();
                }
            }
        });

        roomCodeInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                joinRoomBtn.click();
            }
        });
    </script>
</body>
</html>


